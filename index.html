<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel Mobile â€” Rian Store</title>
<style>
:root{
  --bg:#f7f8fb;
  --card:#fff;
  --accent:#5c2cf7;
  --muted:#6b7280;
  --danger:#ff4d4f;
  --success:#16a34a;
  --shadow:0 4px 12px rgba(0,0,0,0.08);
  font-family:Inter,system-ui,sans-serif;
}
body{margin:0;background:var(--bg);color:#111827}
.container{max-width:480px;margin:auto;padding:12px}
header{display:flex;align-items:center;justify-content:space-between;padding:12px;background:var(--card);box-shadow:var(--shadow);border-radius:12px;margin-bottom:12px}
.logo{width:40px;height:40px;background:linear-gradient(135deg,#5c2cf7,#3ddc97);border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:18px}
h1,h2,h3{margin:0 0 8px 0;font-size:16px}
p{margin:0;font-size:13px;color:var(--muted)}
.card{background:var(--card);border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:var(--shadow)}
input,select{width:100%;padding:12px;margin:6px 0;border:1px solid #ccc;border-radius:8px;box-sizing:border-box;font-size:14px}
button{padding:12px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:14px;width:100%;margin-top:6px}
.btn-primary{background:var(--accent);color:white}
.btn-secondary{background:#eef6ff;color:var(--accent)}
.btn-danger{background:var(--danger);color:white}
.user-card{background:#fff;border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:var(--shadow);display:flex;align-items:flex-start;gap:12px;flex-direction:column;cursor:pointer}
.user-header{display:flex;align-items:center;gap:12px;width:100%}
.user-avatar{width:50px;height:50px;border-radius:50%;background:var(--accent);color:#fff;font-weight:700;font-size:20px;display:flex;align-items:center;justify-content:center}
.user-name{font-weight:700;font-size:16px; flex:1;}
.saldo-container{display:flex;align-items:center;gap:6px;margin-top:4px}
.saldo-container button{width:40px;padding:6px;font-size:14px}
.search-input{margin-bottom:12px}
.popup{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);display:none;align-items:center;justify-content:center;z-index:100}
.popup .popup-content{background:var(--card);padding:20px;border-radius:16px;width:90%;max-width:400px}
.close-popup{float:right;cursor:pointer;font-weight:700;font-size:18px}
.popup h3{margin-bottom:12px;color:var(--accent);text-align:center}
.popup input{margin-bottom:10px}
.popup .popup-button{width:100%;margin-top:8px}
.popup .cancel-btn{background:#eee;color:#555}
table{width:100%;border-collapse:collapse;margin-top:6px}
th,td{padding:8px;border:1px solid #ddd;text-align:left;font-size:14px}
th{background:#f0f0f0}
</style>
</head>
<body>

<div class="container" id="login-screen">
  <div class="card">
    <h2>Login Admin</h2>
    <input type="text" id="admin-username" placeholder="Username">
    <input type="password" id="admin-password" placeholder="Password">
    <button class="btn-primary" id="login-btn">Masuk</button>
  </div>
</div>

<div class="container" id="admin-panel" style="display:none">
  <header>
    <div style="display:flex;align-items:center;gap:8px">
      <div class="logo">RS</div>
      <div>
        <h1>Rian Store</h1>
        <p>ðŸ‘‹ Hallo Admin!! Selamat datang</p>
      </div>
    </div>
    <button class="btn-secondary" id="logout-btn">Keluar</button>
  </header>

  <div class="card">
    <h2>Dashboard</h2>
    <p>Total User: <span id="total-user">0</span></p>
    <p>Total Saldo: <span id="total-saldo">Rp 0</span></p>
    <p>Total Produk: <span id="total-produk">0</span></p>
  </div>

  <input type="text" id="search-user" class="search-input" placeholder="Cari user berdasarkan nama, email, atau WA">
  <div id="user-list"></div>

  <div class="card">
    <h2>Kelola Produk</h2>
    <button class="btn-primary" id="add-product-btn">Tambah Produk</button>
    <table id="product-table"><thead><tr><th>Operator</th><th>Denom</th><th>Harga</th><th>Kode</th><th>Aksi</th></tr></thead><tbody></tbody></table>
  </div>
</div>

<div class="popup" id="popup">
  <div class="popup-content">
    <span class="close-popup" id="close-popup">Ã—</span>
    <div id="popup-body"></div>
  </div>
</div>

<script type="module">
// Firebase setup
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, collection, query, where, getDocs, onSnapshot, addDoc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBj1P1BlyVgusvpVJ_5TcJdqnffVm6In6E",
  authDomain: "tokomiken-6fc10.firebaseapp.com",
  projectId: "tokomiken-6fc10",
  storageBucket: "tokomiken-6fc10.appspot.com",
  messagingSenderId: "454827178083",
  appId: "1:454827178083:web:c83c3627d60942d5af2056"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const ADMIN_USERNAME = "admin";
const ADMIN_PASSWORD = "admin123";

const ACCOUNTS = "accounts";
const PRODUCTS = "products";

let adminLoggedIn = false;

// Login admin
document.getElementById("login-btn").onclick = () => {
  const user = document.getElementById("admin-username").value;
  const pass = document.getElementById("admin-password").value;
  if(user === ADMIN_USERNAME && pass === ADMIN_PASSWORD){
    adminLoggedIn = true;
    document.getElementById("login-screen").style.display = "none";
    document.getElementById("admin-panel").style.display = "block";
    initLiveData();
  } else {
    alert("Username atau password salah!");
  }
};

// Logout
document.getElementById("logout-btn").onclick = () => location.reload();

// Popup
const popup = document.getElementById("popup");
const popupBody = document.getElementById("popup-body");
document.getElementById("close-popup").onclick = () => popup.style.display="none";

// Live update users & products
function initLiveData(){
  const userList = document.getElementById("user-list");
  const totalUserElem = document.getElementById("total-user");
  const totalSaldoElem = document.getElementById("total-saldo");
  const productTable = document.getElementById("product-table").querySelector("tbody");
  const totalProdukElem = document.getElementById("total-produk");

  // Users
  const colUsers = collection(db, ACCOUNTS);
  onSnapshot(colUsers, (snap)=>{
    let totalUser = 0;
    let totalSaldo = 0;
    userList.innerHTML="";
    snap.forEach(docSnap=>{
      const data = docSnap.data();
      totalUser++;
      totalSaldo += data.saldo || 0;
      const div = document.createElement("div");
      div.className="user-card";
      div.innerHTML=`<div class="user-header"><div class="user-avatar">${data.name[0].toUpperCase()}</div>
        <div class="user-name">${data.name}</div>
        </div>
        <div class="saldo-container">Saldo: Rp <span class="saldo">${(data.saldo||0).toLocaleString()}</span>
        <button class="btn-primary edit-saldo" data-id="${docSnap.id}">Edit</button></div>`;
      userList.appendChild(div);
    });
    totalUserElem.innerText = totalUser;
    totalSaldoElem.innerText = "Rp " + totalSaldo.toLocaleString();
  });

  // Products
  const colProducts = collection(db, PRODUCTS);
  onSnapshot(colProducts, (snap)=>{
    productTable.innerHTML="";
    let totalProduk = 0;
    snap.forEach(docSnap=>{
      totalProduk++;
      const data = docSnap.data();
      const tr = document.createElement("tr");
      tr.innerHTML=`<td>${data.operator}</td><td>${data.denom}</td><td>${data.price}</td><td>${data.code}</td>
      <td>
        <button class="btn-primary edit-product" data-id="${docSnap.id}">Edit</button>
        <button class="btn-danger delete-product" data-id="${docSnap.id}">Hapus</button>
      </td>`;
      productTable.appendChild(tr);
    });
    totalProdukElem.innerText = totalProduk;
  });
}

// Edit saldo user
document.addEventListener("click", async(e)=>{
  if(e.target.classList.contains("edit-saldo")){
    const id = e.target.dataset.id;
    const docRef = doc(db, ACCOUNTS, id);
    const docSnap = await getDoc(docRef);
    if(!docSnap.exists()) return alert("User tidak ditemukan");
    const data = docSnap.data();
    const newSaldo = prompt(`Edit saldo ${data.name}`, data.saldo||0);
    if(newSaldo!==null){
      await updateDoc(docRef,{saldo:parseInt(newSaldo)});
    }
  }
});

// Add product
document.getElementById("add-product-btn").onclick=()=>{
  popupBody.innerHTML=`
    <h3>Tambah Produk</h3>
    <input type="text" id="prod-operator" placeholder="Operator">
    <input type="text" id="prod-denom" placeholder="Denom">
    <input type="number" id="prod-price" placeholder="Harga">
    <input type="text" id="prod-code" placeholder="Kode">
    <button class="popup-button" id="save-product-btn">Simpan</button>
  `;
  popup.style.display="flex";

  document.getElementById("save-product-btn").onclick=async()=>{
    const operator = document.getElementById("prod-operator").value;
    const denom = document.getElementById("prod-denom").value;
    const price = parseInt(document.getElementById("prod-price").value);
    const code = document.getElementById("prod-code").value;
    if(!operator||!denom||!price||!code) return alert("Semua kolom wajib diisi");
    await addDoc(collection(db, PRODUCTS),{operator,denom,price,code});
    popup.style.display="none";
  }
});

// Delete & edit product
document.addEventListener("click", async(e)=>{
  if(e.target.classList.contains("delete-product")){
    const id = e.target.dataset.id;
    if(confirm("Hapus produk ini?")){
      await deleteDoc(doc(db, PRODUCTS, id));
    }
  } else if(e.target.classList.contains("edit-product")){
    const id = e.target.dataset.id;
    const docRef = doc(db, PRODUCTS, id);
    const docSnap = await getDoc(docRef);
    if(!docSnap.exists()) return alert("Produk tidak ditemukan");
    const data = docSnap.data();
    popupBody.innerHTML=`
      <h3>Edit Produk</h3>
      <input type="text" id="prod-operator" placeholder="Operator" value="${data.operator}">
      <input type="text" id="prod-denom" placeholder="Denom" value="${data.denom}">
      <input type="number" id="prod-price" placeholder="Harga" value="${data.price}">
      <input type="text" id="prod-code" placeholder="Kode" value="${data.code}">
      <button class="popup-button" id="save-product-btn">Simpan</button>
    `;
    popup.style.display="flex";

    document.getElementById("save-product-btn").onclick=async()=>{
      const operator = document.getElementById("prod-operator").value;
      const denom = document.getElementById("prod-denom").value;
      const price = parseInt(document.getElementById("prod-price").value);
      const code = document.getElementById("prod-code").value;
      if(!operator||!denom||!price||!code) return alert("Semua kolom wajib diisi");
      await updateDoc(docRef,{operator,denom,price,code});
      popup.style.display="none";
    }
  }
});

// Search user
document.getElementById("search-user").oninput=async(e)=>{
  const term = e.target.value.toLowerCase();
  const colUsers = collection(db, ACCOUNTS);
  const snap = await getDocs(colUsers);
  const userList = document.getElementById("user-list");
  userList.innerHTML="";
  snap.forEach(docSnap=>{
    const data = docSnap.data();
    if(data.name.toLowerCase().includes(term)||data.email?.toLowerCase().includes(term)||data.wa?.includes(term)){
      const div = document.createElement("div");
      div.className="user-card";
      div.innerHTML=`<div class="user-header"><div class="user-avatar">${data.name[0].toUpperCase()}</div>
        <div class="user-name">${data.name}</div>
        </div>
        <div class="saldo-container">Saldo: Rp <span class="saldo">${(data.saldo||0).toLocaleString()}</span>
        <button class="btn-primary edit-saldo" data-id="${docSnap.id}">Edit</button></div>`;
      userList.appendChild(div);
    }
  });
}
</script>
</body>
</html>
